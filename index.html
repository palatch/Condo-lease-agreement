<!DOCTYPE html>
<html lang="th">
<head>
    <!-- Meta tags for character set, viewport, and title -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เครื่องมือสร้างสัญญาเช่า (ฉบับสมบูรณ์)</title>

    <!-- External Libraries & Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;500;700&display=swap" rel="stylesheet">

    <!-- Internal Styles -->
    <style>
        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        
        /* A4 Page styling for Desktop and Print */
        .page { 
            width: 210mm;
            min-height: 297mm;
            padding: 15mm;
            padding-bottom: 30mm;
            margin: 10mm auto;
            border: 1px #D3D3D3 solid;
            border-radius: 5px;
            background: white;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
            page-break-after: always; 
            position: relative;
        }
        .page:last-child { page-break-after: avoid; }
        
        .signature-line { margin-top: 2rem; border-bottom: 1px solid #333; }
        
        .signature-container-per-page {
            position: absolute;
            bottom: 40px;
            right: 60px;
            text-align: center;
            font-size: 0.75rem;
        }
        .signature-line-small {
            width: 180px;
            margin: 0 auto;
            border-bottom: 1px solid #333;
            margin-bottom: 0.25rem;
        }

        .clause { margin-bottom: 1rem; }
        .clause-title { font-weight: bold; }
        .english { color: #555; font-style: italic; margin-top: 0.25rem; }

        /* Mobile Responsive adjustments for viewing ONLY */
        @media (max-width: 900px) {
            .page-preview-on-mobile {
                width: 100%;
                min-height: auto;
                margin: 0;
                padding: 1rem;
                padding-bottom: 5rem; /* Space for signature */
                border: none;
                box-shadow: none;
                border-radius: 0;
            }
             .page-preview-on-mobile .signature-container-per-page {
                position: relative;
                bottom: auto;
                right: auto;
                margin-top: 2rem;
                padding-top: 1rem;
                border-top: 1px dashed #ccc;
             }
        }
        
        /* Special style to force A4 rendering for html2canvas */
        .pdf-render-view .page {
             width: 210mm !important;
             min-height: 297mm !important;
             margin: 0 !important;
             border: none !important;
             box-shadow: none !important;
             border-radius: 0 !important;
        }

        /* Print-specific styles */
        @media print {
            html, body {
                width: 210mm;
                height: 297mm;        
            }
            .no-print { display: none; }
            .page {
                margin: 0;
                border: initial;
                border-radius: initial;
                width: initial;
                min-height: initial;
                box-shadow: initial;
                background: initial;
                page-break-after: always;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8 no-print">

    <!-- =========== SETUP FORM =========== -->
    <div id="setup-form" class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-2xl shadow-2xl">
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4">
            <div class="flex items-center space-x-3 mb-3 sm:mb-0">
                 <svg class="h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" />
                </svg>
                <h1 class="text-3xl font-bold text-gray-800">สร้างสัญญาเช่า</h1>
            </div>
            <button id="clear-storage" class="text-xs text-red-500 hover:text-red-700 font-semibold hover:underline transition-colors">ล้างข้อมูลที่บันทึกไว้</button>
        </div>
        <p class="text-center text-gray-500 mb-10">กรอกข้อมูลเพื่อสร้างสัญญาเช่าสองภาษา (ไทย-อังกฤษ) ข้อมูลจะถูกบันทึกอัตโนมัติ</p>
        
        <div class="space-y-10">
            <!-- Lessor Info Section -->
            <div class="p-5 border border-gray-200 rounded-xl">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ข้อมูลผู้ให้เช่า (Lessor)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <input type="text" id="lessor-name" placeholder="ชื่อ-สกุล (Full Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="number" id="lessor-age" placeholder="อายุ (Age)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="lessor-id" placeholder="เลขบัตรประชาชน (ID No.)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="lessor-phone" placeholder="เบอร์โทรศัพท์ (Phone No.)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <textarea id="lessor-address" placeholder="ที่อยู่ (Address)" class="data-field p-3 border border-gray-300 rounded-lg md:col-span-2 focus:ring-2 focus:ring-blue-500 transition"></textarea>
                    <input type="text" id="lessor-bank-name" placeholder="ธนาคาร (Bank Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="lessor-account-name" placeholder="ชื่อบัญชี (Account Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="lessor-account-number" placeholder="เลขที่บัญชี (Account Number)" class="data-field p-3 border border-gray-300 rounded-lg md:col-span-2 focus:ring-2 focus:ring-blue-500 transition"></textarea>
                </div>
            </div>

            <!-- Renter Info Section -->
             <div class="p-5 border border-gray-200 rounded-xl">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ข้อมูลผู้เช่า (Renter)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <input type="text" id="renter-name" placeholder="ชื่อ-สกุล (Full Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="number" id="renter-age" placeholder="อายุ (Age)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="renter-id" placeholder="เลขบัตรประชาชน/พาสปอร์ต (ID/Passport No.)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <input type="text" id="renter-phone" placeholder="เบอร์โทรศัพท์ (Phone Number)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                    <textarea id="renter-address" placeholder="ที่อยู่ (Address)" class="data-field p-3 border border-gray-300 rounded-lg md:col-span-2 focus:ring-2 focus:ring-blue-500 transition"></textarea>
                    
                    <!-- Emergency Contact Section -->
                    <div class="md:col-span-2 mt-4 pt-4 border-t border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-600 mb-3">บุคคลติดต่อฉุกเฉิน (Emergency Contacts)</h3>
                        
                        <!-- Contact 1 -->
                        <p class="font-medium text-gray-500 mb-2">บุคคลที่ 1 (First Contact)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-4">
                            <input type="text" id="emergency-contact-1-name" placeholder="ชื่อ-สกุล (Full Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <input type="text" id="emergency-contact-1-phone" placeholder="เบอร์โทรศัพท์ (Phone Number)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <textarea id="emergency-contact-1-address" placeholder="ที่อยู่ (Address)" class="data-field p-3 border border-gray-300 rounded-lg md:col-span-2 focus:ring-2 focus:ring-blue-500 transition"></textarea>
                        </div>

                        <!-- Contact 2 -->
                        <p class="font-medium text-gray-500 mb-2">บุคคลที่ 2 (Second Contact)</p>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                            <input type="text" id="emergency-contact-2-name" placeholder="ชื่อ-สกุล (Full Name)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <input type="text" id="emergency-contact-2-phone" placeholder="เบอร์โทรศัพท์ (Phone Number)" class="data-field p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 transition">
                            <textarea id="emergency-contact-2-address" placeholder="ที่อยู่ (Address)" class="data-field p-3 border border-gray-300 rounded-lg md:col-span-2 focus:ring-2 focus:ring-blue-500 transition"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contract Info Section -->
            <div class="p-5 border border-gray-200 rounded-xl">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">ข้อมูลสัญญา (Contract Details)</h2>
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-x-5 gap-y-6">
                    <div class="md:col-span-2">
                        <label for="contract-location" class="block text-sm font-medium text-gray-600 mb-1">ชื่อโครงการ (Project Name)</label>
                        <input type="text" id="contract-location" placeholder="เช่น ลุมพินีทาวชิปรังสิตคลอง 1" class="data-field p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div class="md:col-span-2">
                        <label for="room-select" class="block text-sm font-medium text-gray-600 mb-1">ห้องเลขที่ (Room Number)</label>
                        <div class="flex items-center space-x-2">
                            <select id="room-select" class="data-field mt-1 block w-full p-3 border border-gray-300 rounded-lg h-[50px] focus:ring-2 focus:ring-blue-500 transition">
                                <!-- Dynamically populated by JavaScript -->
                            </select>
                            <button type="button" id="remove-room-btn" title="ลบห้องที่เลือก" class="mt-1 p-2 bg-red-600 text-white rounded-lg hover:bg-red-700 h-[50px] w-14 flex items-center justify-center font-bold text-xl transition shadow-sm hover:shadow-md">-</button>
                        </div>
                        <div class="mt-2 flex items-center space-x-2">
                            <input type="text" id="new-room-input" placeholder="เพิ่มห้องใหม่ (เช่น C1-101 1/1)" class="p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                            <button type="button" id="add-room-btn" class="w-auto bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 transition shadow-sm hover:shadow-md whitespace-nowrap">เพิ่มห้อง</button>
                        </div>
                    </div>
                     <div>
                        <label for="rent-amount" class="block text-sm font-medium text-gray-600 mb-1">ค่าเช่าต่อเดือน (Monthly Rent)</label>
                        <input type="number" id="rent-amount" placeholder="5000" class="data-field p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label for="asset-code" class="block text-sm font-medium text-gray-600 mb-1">ยูนิตที่ (Unit No.)</label>
                        <input type="text" id="asset-code" placeholder="ยูนิตที่" class="data-field p-3 border border-gray-200 bg-gray-100 rounded-lg w-full" readonly>
                    </div>
                     <div>
                        <label for="asset-no" class="block text-sm font-medium text-gray-600 mb-1">บ้านเลขที่ (Address No.)</label>
                        <input type="text" id="asset-no" placeholder="บ้านเลขที่" class="data-field p-3 border border-gray-200 bg-gray-100 rounded-lg w-full" readonly>
                    </div>
                    <div>
                        <label for="contract-duration" class="block text-sm font-medium text-gray-600 mb-1">ระยะเวลาเช่า (Lease Duration)</label>
                        <select id="contract-duration" class="data-field p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                            <option value="6">6 เดือน</option>
                            <option value="12" selected>1 ปี (12 เดือน)</option>
                            <option value="24">2 ปี (24 เดือน)</option>
                        </select>
                    </div>
                    <div>
                        <label for="contract-start-date" class="block text-sm font-medium text-gray-600 mb-1">วันที่เริ่มสัญญา (Start Date)</label>
                        <input type="date" id="contract-start-date" class="data-field p-3 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                    </div>
                    <div>
                        <label for="contract-end-date" class="block text-sm font-medium text-gray-600 mb-1">วันที่สิ้นสุดสัญญา (End Date)</label>
                        <input type="date" id="contract-end-date" class="data-field p-3 border border-gray-200 bg-gray-100 rounded-lg w-full" readonly>
                    </div>
                </div>
            </div>

            <!-- Furniture and Appliances Section -->
            <div class="p-5 border border-gray-200 rounded-xl">
                <h2 class="text-xl font-semibold text-gray-700 mb-4">เฟอร์นิเจอร์และเครื่องใช้ไฟฟ้า (Furniture & Appliances)</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Furniture Column -->
                    <div>
                        <h3 class="font-semibold text-gray-600 mb-3">เฟอร์นิเจอร์ (Furniture)</h3>
                        <div id="furniture-list" class="space-y-3">
                            <!-- Furniture items will be injected here by JS -->
                        </div>
                        <div class="mt-4 pt-4 border-t">
                             <div class="flex items-center space-x-2">
                                <input type="text" id="new-furniture-name" placeholder="เพิ่มเฟอร์นิเจอร์ใหม่" class="p-2 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                                <button type="button" id="add-furniture-btn" class="w-auto bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition shadow-sm whitespace-nowrap">เพิ่ม</button>
                            </div>
                        </div>
                    </div>
                    <!-- Appliances Column -->
                    <div>
                        <h3 class="font-semibold text-gray-600 mb-3">เครื่องใช้ไฟฟ้า (Appliances)</h3>
                        <div id="appliances-list" class="space-y-3">
                            <!-- Appliance items will be injected here by JS -->
                        </div>
                         <div class="mt-4 pt-4 border-t">
                             <div class="flex items-center space-x-2">
                                <input type="text" id="new-appliance-name" placeholder="เพิ่มเครื่องใช้ไฟฟ้าใหม่" class="p-2 border border-gray-300 rounded-lg w-full focus:ring-2 focus:ring-blue-500 transition">
                                <button type="button" id="add-appliance-btn" class="w-auto bg-green-600 text-white p-2 rounded-lg hover:bg-green-700 transition shadow-sm whitespace-nowrap">เพิ่ม</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Action Button -->
        <div class="text-center mt-12">
            <button id="preview-contract" class="bg-gradient-to-r from-blue-600 to-indigo-700 text-white font-bold py-4 px-10 rounded-xl hover:from-blue-700 hover:to-indigo-800 transition-all text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                ดูตัวอย่างและสร้าง PDF
            </button>
        </div>

        <!-- Visitor Counter -->
        <div class="text-center mt-8 text-xs text-gray-400">
            จำนวนผู้เข้าชม: <span id="visitor-counter">0</span>
        </div>
    </div>

    <!-- =========== CONTRACT CONTENT (for PDF generation) =========== -->
    <div id="contract-container" class="bg-gray-100" style="display: none;">
        <div id="contract-content" class="max-w-4xl mx-auto">
            <!-- All contract pages will be dynamically populated here by JavaScript -->
        </div>
    </div>

    <!-- =========== ACTION BUTTONS for Preview =========== -->
    <div id="action-buttons" class="max-w-4xl mx-auto my-6 text-center space-x-4 no-print" style="display: none;">
        <button id="edit-info" class="bg-yellow-500 text-white font-bold py-3 px-8 rounded-lg hover:bg-yellow-600 transition-colors shadow-md hover:shadow-lg">กลับไปแก้ไข</button>
        <button id="download-pdf" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 transition-colors shadow-md hover:shadow-lg">ดาวน์โหลด PDF</button>
        <p id="loading-message" class="text-gray-600 mt-2" style="display: none;">กำลังสร้างไฟล์ PDF...</p>
    </div>

    <!-- JavaScript Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const ROOMS_STORAGE_KEY = 'rentalAgreementRooms';
            const FURNITURE_STORAGE_KEY = 'rentalAgreementFurniture';
            let rooms = [];
            let furnitureAndAppliances = [];

            // --- Room Management Functions ---
            const populateRoomSelect = () => {
                const roomSelect = document.getElementById('room-select');
                const savedData = JSON.parse(localStorage.getItem('rentalAgreementData')) || {};
                const selectedRoom = savedData['room-select'];

                roomSelect.innerHTML = '<option value="" disabled>กรุณาเลือกห้อง</option>';
                rooms.forEach(room => {
                    const option = document.createElement('option');
                    option.value = room;
                    option.textContent = room;
                    if (room === selectedRoom) {
                        option.selected = true;
                    }
                    roomSelect.appendChild(option);
                });
                if (!roomSelect.value) {
                    roomSelect.selectedIndex = 0;
                }
            };

            const saveRooms = () => {
                localStorage.setItem(ROOMS_STORAGE_KEY, JSON.stringify(rooms));
            };

            const loadRooms = () => {
                const savedRooms = localStorage.getItem(ROOMS_STORAGE_KEY);
                if (savedRooms && JSON.parse(savedRooms).length > 0) {
                    rooms = JSON.parse(savedRooms);
                } else {
                    rooms = [
                        "C2-503 18/108",
                        "C2-504 18/109",
                        "C2-507 18/112",
                        "C7-326 23/77",
                        "F1-0203 35/25"
                    ];
                }
                populateRoomSelect();
            };

            // --- Furniture & Appliance Management ---
            const saveFurnitureData = () => {
                localStorage.setItem(FURNITURE_STORAGE_KEY, JSON.stringify(furnitureAndAppliances));
            };
            
            const renderFurnitureForm = () => {
                const furnitureListDiv = document.getElementById('furniture-list');
                const appliancesListDiv = document.getElementById('appliances-list');
                furnitureListDiv.innerHTML = '';
                appliancesListDiv.innerHTML = '';

                furnitureAndAppliances.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'grid grid-cols-3 gap-2 items-center';
                    itemDiv.innerHTML = `
                        <label class="col-span-2 flex items-center space-x-2 text-sm cursor-pointer">
                            <input type="checkbox" data-id="${item.id}" class="asset-checkbox h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500" ${item.checked ? 'checked' : ''}>
                            <span>${item.name}</span>
                        </label>
                        <div class="relative">
                            <input type="number" data-id="${item.id}" value="${item.value}" class="asset-value p-1 border border-gray-300 rounded-md w-full text-sm disabled:bg-gray-100 disabled:cursor-not-allowed" ${!item.checked ? 'disabled' : ''}>
                             ${!item.isDefault ? `<button data-id="${item.id}" class="remove-asset-btn absolute -right-6 top-1/2 -translate-y-1/2 text-red-500 font-bold hover:text-red-700 px-2 text-lg">&times;</button>` : ''}
                        </div>
                    `;
                    if (item.type === 'furniture') {
                        furnitureListDiv.appendChild(itemDiv);
                    } else {
                        appliancesListDiv.appendChild(itemDiv);
                    }
                });

                // Add event listeners
                document.querySelectorAll('.asset-checkbox').forEach(box => {
                    box.addEventListener('change', (e) => {
                        const itemId = Number(e.target.dataset.id);
                        const item = furnitureAndAppliances.find(i => i.id === itemId);
                        if(item) {
                            item.checked = e.target.checked;
                            const valueInput = document.querySelector(`.asset-value[data-id="${itemId}"]`);
                            valueInput.disabled = !e.target.checked;
                            saveFurnitureData();
                        }
                    });
                });

                document.querySelectorAll('.asset-value').forEach(input => {
                    input.addEventListener('change', (e) => {
                         const itemId = Number(e.target.dataset.id);
                         const item = furnitureAndAppliances.find(i => i.id === itemId);
                         if(item) {
                            item.value = parseFloat(e.target.value) || 0;
                            saveFurnitureData();
                         }
                    });
                });
                
                document.querySelectorAll('.remove-asset-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const itemId = Number(e.target.dataset.id);
                        furnitureAndAppliances = furnitureAndAppliances.filter(i => i.id !== itemId);
                        saveFurnitureData();
                        renderFurnitureForm();
                    });
                });
            };

            const loadFurnitureData = () => {
                const savedData = localStorage.getItem(FURNITURE_STORAGE_KEY);
                if (savedData) {
                    furnitureAndAppliances = JSON.parse(savedData);
                } else {
                    furnitureAndAppliances = [
                        // Default Furniture
                        { id: 1, name: 'เตียง+ฟูก / Bed+Mattress', value: 10000, checked: false, type: 'furniture', isDefault: true },
                        { id: 2, name: 'ตู้เสื้อผ้า / Wardrobe', value: 10000, checked: false, type: 'furniture', isDefault: true },
                        { id: 3, name: 'ชุดโต๊ะเครื่องแป้ง / Dressing Table', value: 5000, checked: false, type: 'furniture', isDefault: true },
                        { id: 4, name: 'ชั้นวางทีวี / TV Shelf', value: 5000, checked: false, type: 'furniture', isDefault: true },
                        { id: 5, name: 'ชุดโซฟา / Sofa Set', value: 5000, checked: false, type: 'furniture', isDefault: true },
                        { id: 6, name: 'เคาน์เตอร์ซิงค์ล้างจาน', value: 15000, checked: false, type: 'furniture', isDefault: true },
                        { id: 7, name: 'ชุดกุญแจ+คีย์การ์ด', value: 1000, checked: false, type: 'furniture', isDefault: true },
                        // Default Appliances
                        { id: 101, name: 'ทีวี / Television', value: 5000, checked: false, type: 'appliance', isDefault: true },
                        { id: 102, name: 'ตู้เย็น / Refrigerator', value: 5000, checked: false, type: 'appliance', isDefault: true },
                        { id: 103, name: 'ไมโครเวฟ / Microwave', value: 2000, checked: false, type: 'appliance', isDefault: true },
                        { id: 104, name: 'เครื่องทำน้ำอุ่น / Water Heater', value: 3000, checked: false, type: 'appliance', isDefault: true },
                        { id: 105, name: 'เครื่องปรับอากาศ / Air Conditioner', value: 15000, checked: false, type: 'appliance', isDefault: true },
                    ];
                }
                renderFurnitureForm();
            };
            
            const addNewAsset = (type) => {
                const nameInput = document.getElementById(`new-${type}-name`);
                const name = nameInput.value.trim();
                if (name) {
                    furnitureAndAppliances.push({
                        id: Date.now(),
                        name: name,
                        value: 0,
                        checked: true, // Auto-check new items
                        type: type,
                        isDefault: false
                    });
                    saveFurnitureData();
                    renderFurnitureForm();
                    nameInput.value = '';
                }
            };
            
            document.getElementById('add-furniture-btn').addEventListener('click', () => addNewAsset('furniture'));
            document.getElementById('add-appliance-btn').addEventListener('click', () => addNewAsset('appliance'));


            // --- Visitor Counter ---
            const updateVisitorCount = () => {
                let count = localStorage.getItem('rentalAgreementVisitorCount');
                count = count ? parseInt(count) + 1 : 1;
                localStorage.setItem('rentalAgreementVisitorCount', count);
                const counterElement = document.getElementById('visitor-counter');
                if(counterElement) {
                    counterElement.textContent = count;
                }
            };
            updateVisitorCount();

            const formFields = document.querySelectorAll('.data-field');
            const roomSelect = document.getElementById('room-select');
            
            // --- Local Storage Functions for Main Form ---
            const saveFormData = () => {
                const data = {};
                formFields.forEach(field => {
                    data[field.id] = field.value;
                });
                localStorage.setItem('rentalAgreementData', JSON.stringify(data));
            };

            const loadFormData = () => {
                const savedData = localStorage.getItem('rentalAgreementData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    formFields.forEach(field => {
                        if (data[field.id] !== undefined) {
                            field.value = data[field.id];
                        }
                    });
                    if (roomSelect.value) {
                         roomSelect.dispatchEvent(new Event('change'));
                    }
                }
                 calculateEndDate(); // Calculate end date on initial load
            };
            
            formFields.forEach(field => {
                field.addEventListener('change', saveFormData);
            });
            
            document.getElementById('clear-storage').addEventListener('click', () => {
                if(confirm('คุณต้องการล้างข้อมูลที่บันทึกไว้ทั้งหมด (รวมถึงรายการห้องและทรัพย์สิน) ใช่หรือไม่?')) {
                    localStorage.removeItem('rentalAgreementData');
                    localStorage.removeItem(ROOMS_STORAGE_KEY);
                    localStorage.removeItem(FURNITURE_STORAGE_KEY);
                    location.reload();
                }
            });

            // --- Room Selection & Asset Code Logic ---
            roomSelect.addEventListener('change', (e) => {
                const selection = e.target.value;
                if (!selection) {
                    document.getElementById('asset-code').value = '';
                    document.getElementById('asset-no').value = '';
                    return;
                };

                const [code, number] = selection.split(' ');
                document.getElementById('asset-code').value = code || '';
                document.getElementById('asset-no').value = number || '';
                saveFormData(); // Save when room changes
            });

            // --- Add/Remove Room Event Listeners ---
            document.getElementById('add-room-btn').addEventListener('click', () => {
                const newRoomInput = document.getElementById('new-room-input');
                const newRoomValue = newRoomInput.value.trim();
                if (newRoomValue && !rooms.includes(newRoomValue)) {
                    rooms.push(newRoomValue);
                    rooms.sort();
                    saveRooms();
                    populateRoomSelect();
                    roomSelect.value = newRoomValue;
                    roomSelect.dispatchEvent(new Event('change'));
                    newRoomInput.value = '';
                } else if (rooms.includes(newRoomValue)) {
                    alert('ห้องนี้มีอยู่ในรายการแล้ว');
                }
            });

            document.getElementById('remove-room-btn').addEventListener('click', () => {
                const selectedRoom = roomSelect.value;
                if (selectedRoom && confirm(`คุณต้องการลบห้อง "${selectedRoom}" ออกจากรายการใช่หรือไม่?`)) {
                    rooms = rooms.filter(room => room !== selectedRoom);
                    saveRooms();
                    populateRoomSelect();
                    roomSelect.dispatchEvent(new Event('change'));
                } else if (!selectedRoom) {
                    alert('กรุณาเลือกห้องที่ต้องการลบ');
                }
            });
            
            // --- Date Calculation Logic ---
            const durationSelect = document.getElementById('contract-duration');
            const startDateInput = document.getElementById('contract-start-date');
            const endDateInput = document.getElementById('contract-end-date');

            const calculateEndDate = () => {
                const duration = parseInt(durationSelect.value, 10);
                const startDateValue = startDateInput.value;

                if (!startDateValue || isNaN(duration)) {
                    endDateInput.value = '';
                    return;
                }

                const startDate = new Date(startDateValue);
                if (isNaN(startDate.getTime())) {
                    endDateInput.value = '';
                    return;
                }
                
                // Add months and subtract one day to get the correct inclusive end date
                const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + duration, startDate.getDate() - 1);
                
                // Format to YYYY-MM-DD for the input field
                const year = endDate.getFullYear();
                const month = String(endDate.getMonth() + 1).padStart(2, '0');
                const day = String(endDate.getDate()).padStart(2, '0');
                
                endDateInput.value = `${year}-${month}-${day}`;
                endDateInput.dispatchEvent(new Event('change')); // Trigger save to local storage
            };

            durationSelect.addEventListener('change', calculateEndDate);
            startDateInput.addEventListener('change', calculateEndDate);

            const formatDate = (dateString) => {
                if (!dateString) return '[..................]';
                const date = new Date(dateString);
                const options = { year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Asia/Bangkok' };
                return date.toLocaleDateString('th-TH', options);
            };

            const formatCurrency = (num) => {
                const number = parseFloat(num);
                if (isNaN(number)) return '0.00';
                return number.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
            };

            document.getElementById('preview-contract').addEventListener('click', () => {
                const data = {};
                formFields.forEach(field => {
                    data[field.id] = field.value;
                });
                
                const contractTitle = `สัญญาเช่าโครงการ ${data['contract-location'] || '[........]'} / ยูนิต ${data['asset-code'] || '[........]'}`;
                const contractDuration = data['contract-duration'] || 12;
                const fullRoomDetails = `ห้องเลขที่ ${data['room-select'] || '[........]'} โครงการ ${data['contract-location'] || '[........]'}`;
                const rentAmount = parseFloat(data['rent-amount'] || 0);
                const securityDeposit = rentAmount * 2;
                const totalInitialPayment = rentAmount * 3;
                
                const today = new Date().toISOString().slice(0, 10);

                // --- Generate Furniture and Appliances HTML for Contract ---
                const selectedFurnitureHTML = furnitureAndAppliances
                    .filter(item => item.type === 'furniture' && item.checked)
                    .map(item => `<tr class="border-b"><td class="py-1">${item.name}</td><td class="text-right">${formatCurrency(item.value)}</td></tr>`)
                    .join('');

                const selectedAppliancesHTML = furnitureAndAppliances
                    .filter(item => item.type === 'appliance' && item.checked)
                    .map(item => `<tr class="border-b"><td class="py-1">${item.name}</td><td class="text-right">${formatCurrency(item.value)}</td></tr>`)
                    .join('');


                const contractContentEl = document.getElementById('contract-content');
                
                // --- Generate Contract HTML ---
                const contractHTML = `
                    <!-- Page 1 -->
                    <div class="page">
                        <div class="text-center mb-6"><h1 class="text-xl font-bold">${contractTitle}<br><span class="text-lg font-normal">Residential Lease Agreement</span></h1></div>
                        <p class="text-sm">เขียนที่/Write at: ${data['contract-location'] || '[..................]'}</p>
                        <p class="text-sm">วันที่/Date: ${formatDate(today)}</p>
                        <div class="mt-4 text-sm"><p>สัญญานี้ทำขึ้นระหว่าง</p><p class="english">This agreement is made between</p></div>
                        <div class="my-4 p-4 border rounded text-sm"><p><strong class="font-bold">ผู้ให้เช่า (Lessor):</strong> ${data['lessor-name'] || '[..................]'} อายุ/Age ${data['lessor-age'] || '[..]'} ปี</p><p>เลขบัตร/ID No.: ${data['lessor-id'] || '[..................]'} โทร/Tel: ${data['lessor-phone'] || '[..................]'}</p><p>ที่อยู่/Address: ${data['lessor-address'] || '[..................]'}</p></div>
                        <div class="my-4 p-4 border rounded text-sm"><p><strong class="font-bold">ผู้เช่า (Renter):</strong> ${data['renter-name'] || '[..................]'} อายุ/Age ${data['renter-age'] || '[..]'} ปี</p><p>เลขบัตร/ID No.: ${data['renter-id'] || '[..................]'} โทร/Tel: ${data['renter-phone'] || '[..................]'}</p><p>ที่อยู่/Address: ${data['renter-address'] || '[..................]'}</p></div>
                        
                        <div class="my-4 text-sm"><p class="font-bold">บุคคลที่สามารถติดต่อได้ในกรณีฉุกเฉิน / Emergency Contacts</p></div>
                        <div class="my-2 p-4 border rounded text-sm">
                            <p><strong class="font-bold">1:</strong> ${data['emergency-contact-1-name'] || '[..................]'} โทร/Tel: ${data['emergency-contact-1-phone'] || '[..................]'}</p>
                            <p>ที่อยู่/Address: ${data['emergency-contact-1-address'] || '[..................]'}</p>
                        </div>
                        <div class="my-2 p-4 border rounded text-sm">
                            <p><strong class="font-bold">2:</strong> ${data['emergency-contact-2-name'] || '[..................]'} โทร/Tel: ${data['emergency-contact-2-phone'] || '[..................]'}</p>
                            <p>ที่อยู่/Address: ${data['emergency-contact-2-address'] || '[..................]'}</p>
                        </div>

                        <div class="space-y-4 text-sm mt-6">
                            <div class="clause"><p class="clause-title">ข้อ 1: ทรัพย์สินที่เช่า / Article 1: Rented Property</p><p>ผู้ให้เช่าตกลงให้เช่าและผู้เช่าตกลงเช่า ${fullRoomDetails} ต.ประชาธิปัตย์ อ.ธัญบุรี จ.ปทุมธานี 12130 เพื่อวัตถุประสงค์ในการอยู่อาศัยสำหรับผู้พักอาศัยไม่เกิน 2 คน</p><p class="english">The "Lessor" agrees to rent and "Renter" agrees to rent the property at ${fullRoomDetails}, Prachathipat, Thanyaburi, Pathum Thani 12130 for the sole purpose of residence with not exceeding 2 people.</p></div>
                        </div>
                        <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 2 -->
                     <div class="page text-sm">
                        <div class="space-y-4 text-sm">
                           <div class="clause"><p class="clause-title">ข้อ 2: ระยะเวลาการเช่า / Article 2: Term of Agreement</p><p>สัญญามีระยะเวลา ${contractDuration} เดือน เริ่มตั้งแต่วันที่ ${formatDate(data['contract-start-date'])} และสิ้นสุดในวันที่ ${formatDate(data['contract-end-date'])}</p><p class="english">This agreement has a period of ${contractDuration} months, commencing on ${formatDate(data['contract-start-date'])} and ending on ${formatDate(data['contract-end-date'])}.</p></div>
                            <div class="clause"><p class="clause-title">ข้อ 3: ค่าเช่าและการชำระเงิน / Article 3: Rent and Payment</p><p>ค่าเช่าตกลงกันในอัตราเดือนละ ${formatCurrency(rentAmount)} บาท ผู้เช่าจะต้องชำระค่าเช่าล่วงหน้าภายในวันที่ 5 ของแต่ละเดือน โดยโอนเงินเข้าบัญชีธนาคาร ${data['lessor-bank-name'] || '[..................]'} ชื่อบัญชี ${data['lessor-account-name'] || '[..................]'} เลขที่ ${data['lessor-account-number'] || '[..................]'} หากผู้เช่าชำระค่าเช่าล่าช้ากว่ากำหนด ผู้เช่าตกลงจ่ายค่าปรับในอัตรา 200 บาทต่อวัน หากผู้เช่าไม่ชำระค่าเช่าและค่าปรับภายใน 15 วันนับจากวันครบกำหนด ผู้ให้เช่ามีสิทธิ์บอกเลิกสัญญา ยึดเงินประกันทั้งหมด และเข้าครอบครองทรัพย์สินได้ทันที</p><p class="english">The rent is agreed at ${formatCurrency(rentAmount)} Baht per month. The "Renter" shall pay the rent in advance by the 5th of each month by transferring money into ${data['lessor-bank-name'] || '[..................]'} account, Name: ${data['lessor-account-name'] || '[..................]'}, A/C No: ${data['lessor-account-number'] || '[..................]'}. In the event that the "Renter" pays the rent later than the due date, a late fee of 200.00 Baht per day will be applied. If the "Renter" does not pay the rent and fines in full within 15 days, the "Lessor" has the right to terminate the contract, confiscate all rental deposits, and repossess the property immediately.</p></div>
                        </div>
                        <h2 class="text-lg font-bold text-center my-4">ตารางกำหนดการชำระเงิน / Payment Schedule</h2>
                        <table class="w-full border-collapse border border-slate-400">
                            <thead class="bg-slate-100">
                                <tr>
                                    <th class="border border-slate-300 p-2">งวดชำระ<br><span class="font-normal text-xs">Payment Period</span></th>
                                    <th class="border border-slate-300 p-2">รอบการชำระ<br><span class="font-normal text-xs">Payment Cycle</span></th>
                                    <th class="border border-slate-300 p-2">ค่าเช่า<br><span class="font-normal text-xs">Rent Amount</span></th>
                                    <th class="border border-slate-300 p-2">กำหนดชำระ<br><span class="font-normal text-xs">Payment Due</span></th>
                                    <th class="border border-slate-300 p-2">หมายเหตุ<br><span class="font-normal text-xs">Note</span></th>
                                </tr>
                            </thead>
                            <tbody>
                                ${[...Array(parseInt(contractDuration))].map((_, i) => {
                                    const startDate = new Date(data['contract-start-date'] || new Date());
                                    const dueDate = new Date(startDate);
                                    dueDate.setMonth(startDate.getMonth() + i);
                                    const dayOfMonth = startDate.getDate();
                                    const dueDateStr = `${dayOfMonth} ${dueDate.toLocaleString('th-TH', { month: 'long', year: 'numeric' })}`;

                                    return `
                                    <tr>
                                        <td class="border border-slate-300 p-2 text-center">${i + 1}</td>
                                        <td class="border border-slate-300 p-2">ค่าเช่าเดือนที่ ${i + 1} / ${i + 1}${['st','nd','rd'][i] || 'th'} month rent</td>
                                        <td class="border border-slate-300 p-2 text-right">${formatCurrency(rentAmount)}</td>
                                        <td class="border border-slate-300 p-2 text-center">${data['contract-start-date'] ? dueDateStr : '[..................]'}</td>
                                        <td class="border border-slate-300 p-2">${i === 0 ? 'ชำระวันเริ่มสัญญา' : ''}</td>
                                    </tr>
                                `}).join('')}
                            </tbody>
                        </table>
                        <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 3 -->
                    <div class="page text-sm">
                        <div class="clause"><p class="clause-title">ข้อ 4: ค่าส่วนกลาง / Article 4: Common Area Fees</p><p>ผู้ให้เช่าตกลงเป็นผู้รับผิดชอบชำระค่าส่วนกลางตามรอบที่นิติบุคคลอาคารชุดเรียกเก็บ</p><p class="english">The "Lessor" promises to be responsible for paying common fees to the condominium juristic person.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 5: ค่าสาธารณูปโภค / Article 5: Utilities</p><p>ผู้เช่าเป็นผู้รับผิดชอบค่าไฟฟ้าและค่าน้ำประปา ค่าไฟฟ้าให้ชำระโดยตรงกับการไฟฟ้า ค่าน้ำประปาในอัตรา 30 บาทต่อหน่วย ชำระทุก 3 เดือนที่สำนักงานนิติบุคคล ผู้เช่ามีหน้าที่รับและชำระค่าใช้จ่ายเหล่านี้ให้ตรงตามกำหนด ค่าที่จอดรถยนต์ 300 บาท/คัน/เดือน และมอเตอร์ไซค์ 50 บาท/คัน/เดือน ค่าสระว่ายน้ำ 30 บาท/ครั้ง</p><p class="english">The "Renter" is responsible for electricity and water bills. Electricity is paid directly to the authority. Water fee is 30.00 Baht per unit, charged every 3 months, payable at the juristic person office. Car parking is 300.00 Baht/car/month, motorcycle parking is 50.00 Baht/car/month. Swimming pool service fee is 30.00 Baht/time.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 6: เงินประกันการเช่า / Article 6: Security Deposit</p><p>ในวันทำสัญญา ผู้เช่าจะต้องชำระเงินให้แก่ผู้ให้เช่าเป็นจำนวนเงินทั้งสิ้น ${formatCurrency(totalInitialPayment)} บาท ประกอบด้วย (1) ค่าเช่าล่วงหน้า 1 เดือน เป็นเงิน ${formatCurrency(rentAmount)} บาท และ (2) เงินประกันความเสียหายเท่ากับค่าเช่า 2 เดือน เป็นเงิน ${formatCurrency(securityDeposit)} บาท เงินประกันนี้ไม่สามารถนำมาหักเป็นค่าเช่าได้ ผู้ให้เช่าจะคืนเงินประกันให้ภายใน 15 วันหลังจากสิ้นสุดสัญญาและผู้เช่าย้ายออกโดยเรียบร้อย หลังจากหักค่าใช้จ่ายหรือหนี้สินที่ผู้เช่าค้างชำระ (ถ้ามี)</p><p class="english">On the day the rental contract is made, the "Renter" shall pay a total amount of ${formatCurrency(totalInitialPayment)} Baht, consisting of (1) First month's rent in advance: ${formatCurrency(rentAmount)} Baht and (2) Damage security deposit, equivalent to 2 months' rent: ${formatCurrency(securityDeposit)} Baht. This security deposit shall not be used as an excuse for failing to make timely rental payments. The "Lessor" shall return the security deposit within 15 days after the contract ends and the "Renter" has moved out completely, after deducting any outstanding debts or damages.</p></div>
                         <div class="clause"><p class="clause-title">ข้อ 7: ข้อปฏิบัติและข้อห้ามในการอยู่อาศัย / Article 7: Rules and Prohibitions of Occupancy</p>
                            <ul class="list-decimal list-inside space-y-2 mt-2">
                                <li>ห้ามมิให้ผู้เช่าวางทรัพย์สินส่วนตัว เช่น ชั้นวางรองเท้า กีดขวางบริเวณโถงทางเดินหน้าห้องเช่า<p class="english">The Renter is prohibited from placing personal belongings, such as shoe racks, in a manner that obstructs the hallway.</p></li>
                                <li>ผู้เช่าต้องไม่กระทำการใดๆ อันเป็นการส่งเสียงดัง หรือก่อความรำคาญแก่ผู้พักอาศัยในห้องข้างเคียง<p class="english">The Renter shall not engage in any act that creates loud noises or any form of disturbance to residents of adjacent units.</p></li>
                                <li>ห้ามมิให้ผู้เช่าประกอบอาหารหรือกระทำการใดที่ก่อให้เกิดกลิ่นรุนแรงรบกวนผู้พักอาศัยอื่น<p class="english">The Renter is prohibited from any activity that produces strong odors which may disturb other residents.</p></li>
                                <li>ห้ามมิให้ผู้เช่าใช้เปลวไฟในการประกอบอาหารภายในห้องเช่าโดยเด็ดขาด<p class="english">The Renter is strictly prohibited from using an open flame for cooking within the leased premises.</p></li>
                                <li>ห้ามมิให้ผู้เช่าสูบบุหรี่ภายในห้องเช่าและบริเวณระเบียง ให้สูบได้เฉพาะในพื้นที่ที่จัดเตรียมไว้ให้เท่านั้น<p class="english">The Renter is strictly prohibited from smoking inside the premises and on the balcony. Smoking is permitted only in designated areas.</p></li>
                                <li>ห้ามมิให้ผู้เช่านำสัตว์เลี้ยงทุกชนิดเข้ามาเลี้ยงหรือพักอาศัยภายในห้องเช่า<p class="english">The Renter is strictly prohibited from bringing or housing pets of any kind within the premises.</p></li>
                                <li>ห้ามนำเข้าหรือเก็บรักษาสิ่งของผิดกฎหมายหรือวัตถุอันตรายไว้ในห้องเช่า<p class="english">The Renter shall not bring or store illegal items or hazardous materials within the premises.</p></li>
                            </ul>
                        </div>
                         <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 4 -->
                    <div class="page text-sm">
                        <div class="clause"><p class="clause-title">ข้อ 8: การบำรุงรักษา / Article 8: Maintenance</p><p>ผู้เช่าสัญญาว่าจะดูแลรักษาห้องเช่าและทรัพย์สินของผู้ให้เช่าให้อยู่ในสภาพดีเสมอ หากมีความเสียหายเล็กน้อย ผู้เช่าเป็นผู้รับผิดชอบค่าใช้จ่ายในการซ่อมแซม หากเป็นความเสียหายใหญ่ ผู้ให้เช่าเป็นผู้รับผิดชอบ</p><p class="english">The "Renter" promises to keep the rental room and the rented property clean and in good condition. The "Renter" is responsible for minor repairs. For major repairs, the "Lessor" is responsible for the expenses.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 9: การดัดแปลงและแก้ไข / Article 9: Alteration and Modification</p><p>ผู้เช่าจะต้องไม่ดัดแปลง ต่อเติม หรือแก้ไขทรัพย์สินที่เช่าโดยไม่ได้รับความยินยอมเป็นลายลักษณ์อักษรจากผู้ให้เช่าก่อน หากผู้เช่าฝ่าฝืน ผู้ให้เช่ามีสิทธิ์เรียกร้องให้ผู้เช่าทำให้ทรัพย์สินกลับสู่สภาพเดิมหรือเรียกเก็บค่าเสียหายได้</p><p class="english">The "Tenant" shall not alter, extend, demolish, or modify the leased premises, in whole or in part, unless prior written consent is obtained from the "Lessor". If the Tenant violates this provision, the "Lessor" shall have the right to require the "Tenant" to restore the leased premises to its original condition or to claim compensation for any all costs and damages.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 10: การละทิ้งทรัพย์สิน / Article 10: Abandonment</p><p>ในกรณีที่ผู้เช่าไม่อยู่อาศัยในห้องเช่าเป็นระยะเวลาเกิน 30 วันโดยไม่ได้ชำระค่าเช่าและไม่ได้แจ้งให้ผู้ให้เช่าทราบเป็นลายลักษณ์อักษร ให้ถือว่าสัญญาเช่าสิ้นสุดลง และผู้ให้เช่ามีสิทธิ์ริบเงินประกันทั้งหมด</p><p class="english">Failure to use and occupy rental rooms for a period of more than 30 days without the rent has been paid in advance and without notifying the "lessor" in writing, it is considered that the rental contract has ended and the "lessor" has the right to immediately forfeit all rental security deposits.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 11: การให้เช่าช่วง / Article 11: Subletting</p><p>ผู้เช่าจะไม่นำทรัพย์สินที่เช่าทั้งหมดหรือบางส่วนไปให้เช่าช่วง เว้นแต่จะได้รับความยินยอมเป็นลายลักษณ์อักษรจากผู้ให้เช่า</p><p class="english">The "Renter" will not sublet or transfer the leasehold rights, whether in whole or in part to others, unless there is consent from the "Lessor" in writing only.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 12: การเข้าตรวจ / Article 12: Inspection</p><p>ผู้ให้เช่าหรือตัวแทนมีสิทธิ์เข้าตรวจดูทรัพย์สินที่เช่าได้เป็นครั้งคราวตามเวลาที่เหมาะสม เพื่อตรวจสอบหรือซ่อมแซม โดยต้องแจ้งให้ผู้เช่าทราบล่วงหน้าอย่างน้อย 2 วัน</p><p class="english">The "Renter" promises to allow the "Lessor" or representative to inspect the rental room from time to time for a reasonably appropriate period, provided that the "Lessor" must notify the "Renter" in writing at least 2 days in advance.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 13: การปฏิบัติตามกฎระเบียบ / Article 13: Compliance with Regulations</p><p>ผู้เช่าตกลงที่จะปฏิบัติตามกฎระเบียบของนิติบุคคลอาคารชุดอย่างเคร่งครัด หากมีความเสียหายเกิดขึ้น ผู้เช่าจะต้องรับผิดชอบค่าเสียหายทั้งหมด</p><p class="english">The "Tenant" promises to strictly comply with the rules and regulations of the condominium. The "Renter" agrees to be responsible for compensating damages to the condominium juristic person.</p></div>
                        <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 5 -->
                    <div class="page text-sm">
                        <div class="clause"><p class="clause-title">ข้อ 14: การติดต่อ / Article 14: Contact</p><p>การติดต่อระหว่างนิติบุคคลอาคารชุดกับผู้ให้เช่า ไม่ว่าจะเป็นหนังสือบอกกล่าวหรือรายละเอียดอื่นใดที่ส่งไปยังห้องเช่า ถือเป็นหน้าที่ของผู้เช่าที่จะต้องแจ้งให้ผู้ให้เช่าทราบโดยทันที มิฉะนั้นหากเกิดความเสียหายใดๆ อันเนื่องมาจากความประมาทของผู้เช่า ผู้เช่าจะต้องเป็นผู้รับผิดชอบค่าเสียหายทั้งหมด</p><p class="english">Contact between the condominium juristic person and the "lessor" whether it be a letter Notice or any other details that has been sent to the condominium unit, it is the duty of the "renter" to notify the "lessor" immediately; otherwise, if any damage occurs due to the tenant's neglect, the "renter" will be the person responsible for all damages himself.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 15: การส่งเอกสาร / Article 15: Notification</p><p>การส่งเอกสารใดๆ เป็นลายลักษณ์อักษรโดยผู้ให้เช่า ไปยังห้องเช่าหรือตู้จดหมาย ถือว่าผู้เช่าได้รับแล้วโดยถูกต้อง</p><p class="english">Any written document delivered to the "renter" at the rental room or Mail Box, a mailbox provided by the project, it is considered to have reached the "renter" correctly.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 16: การต่อสัญญา / Article 16: Lease Term Expires</p><p>เมื่อครบกำหนดอายุสัญญาเช่า ให้ถือว่าสัญญานี้เป็นอันยกเลิก หากผู้เช่าประสงค์จะเช่าต่อต้องจัดทำสัญญาเช่าฉบับใหม่ ทั้งนี้ผู้ให้เช่าขอสงวนสิทธิ์ในการพิจารณา</p><p class="english">When the lease term expires, it is considered that this contract is canceled immediately if the "renter" wishes to continue renting. A new rental contract must be prepared. However, the "lessor" reserves the right to consider renting.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 17: การย้ายออก / Article 17: Moving Out</p><p>เมื่อครบกำหนดอายุสัญญาเช่าหรือมีการบอกเลิกสัญญาไม่ว่าด้วยเหตุผลใดๆ ผู้เช่าจะต้องย้ายทรัพย์สินในส่วนที่เป็นของผู้เช่าออกจากห้องเช่า และส่งมอบการครอบครองห้องเช่าพร้อมทรัพย์สินของผู้ให้เช่าคืนในสภาพดี ภายใน 5 วันนับจากวันสิ้นสุดสัญญา หากผู้เช่าไม่ย้ายออกตามกำหนด ผู้เช่าตกลงชำระค่าปรับวันละ 1,000 บาท</p><p class="english">When the lease term expires or the contract was not renewed, the "renter" must move property only in the part that the "renter" owns and remove servants from the rental room, and deliver possession of the property in good condition within 5 days after the contract expiration date. If the "renter" is delayed in returning the rental room for any reason, the "renter" agrees. Pay the fine at the rate of 1,000.00 baht per day.</p></div>
                        <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 6 - Asset List -->
                    <div class="page text-sm">
                        <h2 class="text-lg font-bold text-center">รายการแสดงทรัพย์สินที่เช่าและอุปกรณ์ตกแต่งห้องเช่าประกอบท้ายสัญญา<br>
                        <span class="text-base font-normal">โครงการ ${data['contract-location'] || '[........]'}</span><br>
                        <span class="text-base font-normal english">List of Rented Property and Furnishings Attached to the Contract</span></h2>
                        <div class="flex justify-between my-4">
                            <span>ยูนิตที่ / Unit No.: ${data['asset-code'] || '[........]'}</span>
                            <span>บ้านเลขที่ / Address No.: ${data['asset-no'] || '[........]'}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-x-8">
                            <div>
                                <h3 class="font-bold text-base mb-2">เฟอร์นิเจอร์ / Furniture</h3>
                                <table class="w-full">
                                   <tbody>
                                        ${selectedFurnitureHTML}
                                   </tbody>
                                </table>
                            </div>
                             <div>
                                <h3 class="font-bold text-base mb-2">เครื่องใช้ไฟฟ้าและอื่นๆ / Electrical Appliances & Others</h3>
                                <table class="w-full">
                                   <tbody>
                                        ${selectedAppliancesHTML}
                                   </tbody>
                                </table>
                            </div>
                        </div>
                         <div class="signature-container-per-page"><div class="signature-line-small"></div><p>( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                    </div>
                    <!-- Page 7 - Final Clauses and Signatures -->
                     <div class="page text-sm">
                        <div class="clause"><p class="clause-title">ข้อ 18: กรณีผู้เช่ามีหนี้สินล้นพ้นตัว / Article 18: Renter's Insolvency</p><p>ในกรณีที่ผู้เช่าถูกฟ้องร้องในคดีล้มละลาย หรือถูกศาลพิทักษ์ทรัพย์ หรือมีเหตุอันสมควรเชื่อได้ว่าผู้เช่ามีหนี้สินล้นพ้นตัว ผู้ให้เช่ามีสิทธิ์ที่จะบอกเลิกสัญญาเช่าและยึดเงินประกันได้</p><p class="english">In case in which the "renter" does not comply with any of the provisions of this contract or become a person with insolvent debts or become bankrupt, the "lessor" has the right to terminate this contract and has the right to immediately forfeit all rental security deposits.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 19: การผิดสัญญา / Article 19: Contract Defaults</p><p>หากคู่สัญญาฝ่ายใดฝ่ายหนึ่งผิดสัญญาเช่าข้อใดข้อหนึ่ง คู่สัญญาอีกฝ่ายมีสิทธิ์บอกเลิกสัญญาได้ทันที และหากมีความเสียหายเกิดขึ้น คู่สัญญาฝ่ายที่ผิดจะต้องรับผิดชอบในความเสียหายทั้งหมด</p><p class="english">If one of the parties to the contract defaults on any of the terms of the contract The other party has the right to terminate. Promise immediately And if this contract is breached, it must enter into legal processes and court processes to enforce compliance with the contract. The party that breaches the contract will be responsible for all those costs.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 20: อากรแสตมป์ / Article 20: Stamp Duty</p><p>ผู้เช่าเป็นฝ่ายชำระค่าอากรแสตมป์ตามกฎหมาย</p><p class="english">The "renter" is the party who pays stamp duty according to law.</p></div>
                        <div class="clause"><p class="clause-title">ข้อ 21: คู่ฉบับสัญญา / Article 21: Counterpart</p><p>สัญญานี้ทำขึ้นเป็น 2 ฉบับ มีข้อความถูกต้องตรงกัน คู่สัญญาทั้งสองฝ่ายได้อ่านและเข้าใจข้อความในสัญญานี้ตลอดแล้ว จึงได้ลงลายมือชื่อไว้เป็นหลักฐานต่อหน้าพยาน และเก็บไว้ฝ่ายละฉบับ</p><p class="english">This contract is made in 2 copies with the same content. Both parties have read and understood the contents of This Contract throughout saw that it was correct and exactly as intended Therefore, he signed his name as evidence in the presence of witnesses. and keep one contract for each party.</p></div>
                        <div class="clause"><p class="clause-title">หมายเหตุเพิ่มเติม / Other additional notes</p><p>(1) ผู้เช่าจะต้องล้างเครื่องปรับอากาศทุกๆ 6 เดือน และเป็นผู้รับผิดชอบค่าใช้จ่ายในการล้างเครื่องปรับอากาศ</p><p class="english">(1) The "renter" must clean the air conditioner every 6 months. The renter must be responsible for the cost of cleaning the air conditioner.</p></div>
                        <div class="clause"><p class="clause-title">ข้อตกลงเพิ่มเติม / Additional Agreement</p><p>หลังสิ้นสุดสัญญาเช่า "ผู้เช่า" จะต้องชำระค่าทำความสะอาดห้องเป็นจำนวนเงิน 1,000.00 บาท (หนึ่งพันบาทถ้วน) ยกเว้นแต่ "ผู้เช่า" จะทำความสะอาดห้องเช่าเอง</p><p class="english">After the end of the rental contract, the "renter" must pay an amount for cleaning the rental room 1,000.00 baht. Except the "renter" will clean the rental room himself.</p></div>
                        <!-- Final Signature Section -->
                        <div id="signature-section" class="mt-8 pt-6 text-sm">
                            <h2 class="text-lg font-bold text-center mb-6">ลงนามในสัญญา / Contract Signature</h2>
                            <div class="grid grid-cols-2 gap-16 mb-12">
                                <div class="text-center"><div class="signature-line"></div><p class="mt-2">( ${data['lessor-name'] || '..............................'} )</p><p>ผู้ให้เช่า / Lessor</p></div>
                                <div class="text-center"><div class="signature-line"></div><p class="mt-2">( ${data['renter-name'] || '..............................'} )</p><p>ผู้เช่า / Renter</p></div>
                            </div>
                            <div class="grid grid-cols-2 gap-16">
                                <div class="text-center"><div class="signature-line"></div><p class="mt-2">(.................................................................)</p><p>พยาน / Witness</p></div>
                                <div class="text-center"><div class="signature-line"></div><p class="mt-2">(.................................................................)</p><p>พยาน / Witness</p></div>
                            </div>
                        </div>
                    </div>
                `;
                contractContentEl.innerHTML = contractHTML;

                // Add mobile preview class to all generated pages
                contractContentEl.querySelectorAll('.page').forEach(page => page.classList.add('page-preview-on-mobile'));

                document.getElementById('setup-form').style.display = 'none';
                document.getElementById('contract-container').style.display = 'block';
                document.getElementById('action-buttons').style.display = 'block';
            });

            document.getElementById('edit-info').addEventListener('click', () => {
                document.getElementById('setup-form').style.display = 'block';
                document.getElementById('contract-container').style.display = 'none';
                document.getElementById('action-buttons').style.display = 'none';
            });

            document.getElementById('download-pdf').addEventListener('click', () => {
                const { jsPDF } = window.jspdf;
                const content = document.getElementById('contract-content');
                const loadingMessage = document.getElementById('loading-message');
                const actionButtons = document.getElementById('action-buttons');
                const contractContainer = document.getElementById('contract-container');
                
                actionButtons.style.display = 'none';
                loadingMessage.style.display = 'block';

                // Add class to force A4 rendering styles
                contractContainer.classList.add('pdf-render-view');

                let promiseChain = Promise.resolve();
                const pdf = new jsPDF('p', 'mm', 'a4');
                const pages = content.querySelectorAll('.page');

                pages.forEach((page, index) => {
                    promiseChain = promiseChain.then(() => 
                        html2canvas(page, { 
                            scale: 2, 
                            useCORS: true,
                            // Ensure it renders at full A4 width
                            windowWidth: page.scrollWidth,
                            windowHeight: page.scrollHeight
                        }).then(canvas => {
                            if (index > 0) {
                                pdf.addPage();
                            }
                            const imgData = canvas.toDataURL('image/png', 0.95);
                            pdf.addImage(imgData, 'PNG', 0, 0, 210, 297, undefined, 'FAST');
                        })
                    );
                });

                promiseChain.finally(() => {
                    pdf.save('สัญญาเช่าสองภาษา.pdf');
                    actionButtons.style.display = 'block';
                    loadingMessage.style.display = 'none';
                    // IMPORTANT: remove the class to restore normal view
                    contractContainer.classList.remove('pdf-render-view');
                });
            });
            
            // --- Initial Load Sequence ---
            loadRooms();
            loadFurnitureData();
            loadFormData();
        });
    </script>
</body>
</html>

